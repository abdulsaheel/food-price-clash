<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodClash - Compare Food Prices</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e5e5e5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border: 1px solid #404040;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            border-color: #525252;
        }
        
        .food-image {
            aspect-ratio: 16/10;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
            background: linear-gradient(45deg, #404040, #525252);
        }
        
        .price-comparison-bar {
            height: 6px;
            background: linear-gradient(90deg, #6366f1 0%, #10b981 100%);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .price-comparison-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border: 1px solid #525252;
            color: #d1d5db;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%);
            border-color: #6b7280;
        }
        
        .input-field {
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid #404040;
            color: #e5e5e5;
            backdrop-filter: blur(10px);
        }
        
        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .tab-button {
            position: relative;
            overflow: hidden;
        }
        
        .tab-button.active::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }
        
        .loading-spinner {
            border: 3px solid rgba(99, 102, 241, 0.3);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #374151;
            transition: .4s;
            border-radius: 30px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: #6366f1;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <!-- Header -->
        <header class="text-center py-12">
            <div class="mb-6">
                <i class="fas fa-utensils text-6xl text-purple-400 mb-4"></i>
                <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                    FoodClash
                </h1>
                <p class="text-xl text-gray-400 mt-2">Compare prices, find the best deals</p>
            </div>
        </header>

        <div class="container mx-auto px-4 pb-12">
            <!-- Search Form -->
            <div class="max-w-2xl mx-auto card rounded-2xl p-8 mb-12">
                <form id="searchForm" class="space-y-6">
                    <!-- Location/Pincode Toggle -->
                    <div class="flex items-center justify-center mb-6">
                        <span class="text-gray-300 mr-3">City</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="searchModeToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="text-gray-300 ml-3">Pincode</span>
                    </div>

                    <!-- City Selection -->
                    <div id="citySelection">
                        <label for="location" class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-map-marker-alt mr-2"></i>Select City
                        </label>
                        <select id="location" name="location" 
                               class="input-field w-full px-4 py-3 rounded-lg focus:outline-none">
                            <option value="">Choose your city</option>
                            <option value="Agra">Agra</option>
                            <option value="Ahmedabad">Ahmedabad</option>
                            <option value="Ajmer">Ajmer</option>
                            <option value="Alappuzha">Alappuzha</option>
                            <option value="Allahabad">Allahabad</option>
                            <option value="Amravati">Amravati</option>
                            <option value="Amritsar">Amritsar</option>
                            <option value="Aurangabad">Aurangabad</option>
                            <option value="Bengaluru">Bengaluru</option>
                            <option value="Bhopal">Bhopal</option>
                            <option value="Bhubaneswar">Bhubaneswar</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Chennai">Chennai</option>
                            <option value="Coimbatore">Coimbatore</option>
                            <option value="Cuttack">Cuttack</option>
                            <option value="Darjeeling">Darjeeling</option>
                            <option value="Dehradun">Dehradun</option>
                            <option value="Delhi NCR">Delhi NCR</option>
                            <option value="Dharamshala">Dharamshala</option>
                            <option value="Gangtok">Gangtok</option>
                            <option value="Goa">Goa</option>
                            <option value="Gorakhpur">Gorakhpur</option>
                            <option value="Guntur">Guntur</option>
                            <option value="Guwahati">Guwahati</option>
                            <option value="Gwalior">Gwalior</option>
                            <option value="Haridwar">Haridwar</option>
                            <option value="Hyderabad" selected>Hyderabad</option>
                            <option value="Indore">Indore</option>
                            <option value="Jabalpur">Jabalpur</option>
                            <option value="Jaipur">Jaipur</option>
                            <option value="Jalandhar">Jalandhar</option>
                            <option value="Jammu">Jammu</option>
                            <option value="Jamnagar">Jamnagar</option>
                            <option value="Jamshedpur">Jamshedpur</option>
                            <option value="Jhansi">Jhansi</option>
                            <option value="Jodhpur">Jodhpur</option>
                            <option value="Junagadh">Junagadh</option>
                            <option value="Kanpur">Kanpur</option>
                            <option value="Khajuraho">Khajuraho</option>
                            <option value="Khamgaon">Khamgaon</option>
                            <option value="Kharagpur">Kharagpur</option>
                            <option value="Kochi">Kochi</option>
                            <option value="Kolhapur">Kolhapur</option>
                            <option value="Kolkata">Kolkata</option>
                            <option value="Kota">Kota</option>
                            <option value="Lucknow">Lucknow</option>
                            <option value="Ludhiana">Ludhiana</option>
                            <option value="Madurai">Madurai</option>
                            <option value="Manali">Manali</option>
                            <option value="Mangalore">Mangalore</option>
                            <option value="Manipal">Manipal</option>
                            <option value="Meerut">Meerut</option>
                            <option value="Mumbai">Mumbai</option>
                            <option value="Mussoorie">Mussoorie</option>
                            <option value="Mysore">Mysore</option>
                            <option value="Nagpur">Nagpur</option>
                            <option value="Nainital">Nainital</option>
                            <option value="Nashik">Nashik</option>
                            <option value="Neemrana">Neemrana</option>
                            <option value="Ooty">Ooty</option>
                            <option value="Palakkad">Palakkad</option>
                            <option value="Patiala">Patiala</option>
                            <option value="Patna">Patna</option>
                            <option value="Puducherry">Puducherry</option>
                            <option value="Pune">Pune</option>
                            <option value="Pushkar">Pushkar</option>
                            <option value="Raipur">Raipur</option>
                            <option value="Rajkot">Rajkot</option>
                            <option value="Ranchi">Ranchi</option>
                            <option value="Rishikesh">Rishikesh</option>
                            <option value="Salem">Salem</option>
                            <option value="Shimla">Shimla</option>
                            <option value="Siliguri">Siliguri</option>
                            <option value="Srinagar">Srinagar</option>
                            <option value="Surat">Surat</option>
                            <option value="Thrissur">Thrissur</option>
                            <option value="Tirupati">Tirupati</option>
                            <option value="Trichy">Trichy</option>
                            <option value="Trivandrum">Trivandrum</option>
                            <option value="Udaipur">Udaipur</option>
                            <option value="Vadodara">Vadodara</option>
                            <option value="Varanasi">Varanasi</option>
                            <option value="Vellore">Vellore</option>
                            <option value="Vijayawada">Vijayawada</option>
                            <option value="Visakhapatnam">Visakhapatnam</option>
                        </select>
                    </div>

                    <!-- Pincode Input -->
                    <div id="pincodeSelection" class="hidden">
                        <label for="pincode" class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-map-pin mr-2"></i>Enter Pincode
                        </label>
                        <input type="text" id="pincode" name="pincode" 
                               class="input-field w-full px-4 py-3 rounded-lg focus:outline-none" 
                               placeholder="e.g., 500001"
                               pattern="[0-9]{6}"
                               maxlength="6">
                        <p class="text-xs text-gray-400 mt-1">We'll find restaurants in nearby cities</p>
                    </div>

                    <div>
                        <label for="food_item" class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-hamburger mr-2"></i>What are you craving?
                        </label>
                        <select id="food_item" name="food_item" 
                               class="input-field w-full px-4 py-3 rounded-lg focus:outline-none" 
                               required>
                            <option value="">Choose your food</option>
                            <option value="biryani">üçõ Biryani</option>
                            <option value="pizza" selected>üçï Pizza</option>
                            <option value="Chicken">üçó Chicken</option>
                            <option value="burger">üçî Burger</option>
                            <option value="ice-cream">üç® Ice Cream</option>
                            <option value="fried-rice">üçö Fried Rice</option>
                            <option value="shawarma">üåØ Shawarma</option>
                            <option value="noodles">üçú Noodles</option>
                            <option value="rolls">üåØ Rolls</option>
                            <option value="thali">üçΩÔ∏è Thali</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-4 px-6 rounded-lg font-semibold text-lg flex items-center justify-center">
                        <i class="fas fa-search mr-3"></i> Find Best Deals
                    </button>
                </form>
            </div>
            <!-- Loading State -->
            <div id="loading" class="text-center hidden">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-400 text-lg">Searching for the best deals...</p>
            </div>

            <!-- Results Section -->
            <div id="results" class="hidden">
                <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
                    <h2 class="text-3xl font-bold text-white">Search Results</h2>
                    <div class="flex space-x-2">
                        <button id="showCommon" class="tab-button btn-primary px-6 py-3 rounded-lg font-medium active">
                            <i class="fas fa-balance-scale mr-2"></i>Compare
                        </button>
                        <button id="showSwiggy" class="tab-button btn-secondary px-6 py-3 rounded-lg font-medium">
                            <i class="fas fa-motorcycle mr-2"></i>Swiggy
                        </button>
                        <button id="showZomato" class="tab-button btn-secondary px-6 py-3 rounded-lg font-medium">
                            <i class="fas fa-utensils mr-2"></i>Zomato
                        </button>
                    </div>
                </div>

                <div id="commonResults" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Common results will be inserted here -->
                </div>

                <div id="swiggyResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
                    <!-- Swiggy results will be inserted here -->
                </div>

                <div id="zomatoResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
                    <!-- Zomato results will be inserted here -->
                </div>
            </div>

            <!-- No Results -->
            <div id="noResults" class="hidden text-center py-16">
                <div class="mb-6">
                    <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
                    <h3 class="text-2xl font-semibold text-gray-300 mb-2">No results found</h3>
                    <p class="text-gray-400">Try a different search term or location</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle between city and pincode search
        document.getElementById('searchModeToggle').addEventListener('change', function() {
            const citySelection = document.getElementById('citySelection');
            const pincodeSelection = document.getElementById('pincodeSelection');
            const locationSelect = document.getElementById('location');
            const pincodeInput = document.getElementById('pincode');
            
            if (this.checked) {
                // Switch to pincode mode
                citySelection.classList.add('hidden');
                pincodeSelection.classList.remove('hidden');
                locationSelect.removeAttribute('required');
                pincodeInput.setAttribute('required', 'required');
            } else {
                // Switch to city mode
                citySelection.classList.remove('hidden');
                pincodeSelection.classList.add('hidden');
                locationSelect.setAttribute('required', 'required');
                pincodeInput.removeAttribute('required');
            }
        });

        // Form submission handler
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const isUsingPincode = document.getElementById('searchModeToggle').checked;
            const location = document.getElementById('location').value;
            const pincode = document.getElementById('pincode').value;
            const foodItem = document.getElementById('food_item').value;
            
            // Validate inputs
            if (!isUsingPincode && !location) {
                alert('Please select a city');
                return;
            }
            if (isUsingPincode && !pincode) {
                alert('Please enter a pincode');
                return;
            }
            if (isUsingPincode && !/^\d{6}$/.test(pincode)) {
                alert('Please enter a valid 6-digit pincode');
                return;
            }
            
            // Show loading state
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('noResults').classList.add('hidden');
            
            try {
                const requestBody = {
                    food_item: foodItem
                };
                
                // Add either location or pincode to the request
                if (isUsingPincode) {
                    requestBody.pincode = pincode;
                } else {
                    requestBody.location = location;
                }
                
                const response = await fetch('http://127.0.0.1:8000/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                // Hide loading
                document.getElementById('loading').classList.add('hidden');
                
                if ((!data.swiggy_results || data.swiggy_results.length === 0) && 
                    (!data.zomato_results || data.zomato_results.length === 0)) {
                    document.getElementById('noResults').classList.remove('hidden');
                    return;
                }
                
                // Display results with Compare tab first
                displayResults(data);
                document.getElementById('results').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('noResults').classList.remove('hidden');
            }
        });

        function displayResults(data) {
            const swiggyContainer = document.getElementById('swiggyResults');
            const commonContainer = document.getElementById('commonResults');
            const zomatoContainer = document.getElementById('zomatoResults');
            
            // Clear previous results
            swiggyContainer.innerHTML = '';
            commonContainer.innerHTML = '';
            zomatoContainer.innerHTML = '';
            
            // Process Swiggy results
            const swiggyItems = [];
            if (data.swiggy_results && data.swiggy_results.length > 0) {
                data.swiggy_results.forEach(item => {
                    if (item.Restaurant === "N/A") return;
                    swiggyItems.push(item);
                    const card = createSwiggyCard(item);
                    swiggyContainer.appendChild(card);
                });
            } else {
                swiggyContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-400 text-lg">No Swiggy results found</p></div>';
            }
            
            // Process Zomato results
            const zomatoItems = [];
            if (data.zomato_results && data.zomato_results.length > 0) {
                data.zomato_results.forEach(item => {
                    if (item.Name === "N/A") return;
                    zomatoItems.push(item);
                    const card = createZomatoCard(item);
                    zomatoContainer.appendChild(card);
                });
            } else {
                zomatoContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-400 text-lg">No Zomato results found</p></div>';
            }
            
            // Find common restaurants with improved matching
            const commonRestaurants = findCommonRestaurants(swiggyItems, zomatoItems);
            
            // Display common results first
            if (commonRestaurants.length > 0) {
                commonRestaurants.forEach(pair => {
                    const card = createCommonCard(pair.swiggy, pair.zomato);
                    commonContainer.appendChild(card);
                });
            } else {
                commonContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-400 text-lg">No common restaurants found between platforms</p></div>';
            }
            
            // Set up tab switching (remove previous event listeners)
            const commonBtn = document.getElementById('showCommon');
            const swiggyBtn = document.getElementById('showSwiggy');
            const zomatoBtn = document.getElementById('showZomato');
            
            // Clone buttons to remove all event listeners
            const newCommonBtn = commonBtn.cloneNode(true);
            const newSwiggyBtn = swiggyBtn.cloneNode(true);
            const newZomatoBtn = zomatoBtn.cloneNode(true);
            
            commonBtn.parentNode.replaceChild(newCommonBtn, commonBtn);
            swiggyBtn.parentNode.replaceChild(newSwiggyBtn, swiggyBtn);
            zomatoBtn.parentNode.replaceChild(newZomatoBtn, zomatoBtn);
            
            // Add new event listeners
            newCommonBtn.addEventListener('click', () => {
                showTab('common');
            });
            
            newSwiggyBtn.addEventListener('click', () => {
                showTab('swiggy');
            });
            
            newZomatoBtn.addEventListener('click', () => {
                showTab('zomato');
            });
            
            // Show Compare tab by default
            showTab('common');
        }

        function showTab(activeTab) {
            const commonResults = document.getElementById('commonResults');
            const swiggyResults = document.getElementById('swiggyResults');
            const zomatoResults = document.getElementById('zomatoResults');
            
            const commonBtn = document.getElementById('showCommon');
            const swiggyBtn = document.getElementById('showSwiggy');
            const zomatoBtn = document.getElementById('showZomato');
            
            // Hide all tabs
            commonResults.classList.add('hidden');
            swiggyResults.classList.add('hidden');
            zomatoResults.classList.add('hidden');
            
            // Reset button styles
            [commonBtn, swiggyBtn, zomatoBtn].forEach(btn => {
                btn.className = btn.className.replace('btn-primary', 'btn-secondary').replace('active', '');
            });
            
            // Show active tab and update button
            if (activeTab === 'common') {
                commonResults.classList.remove('hidden');
                commonBtn.className = commonBtn.className.replace('btn-secondary', 'btn-primary') + ' active';
            } else if (activeTab === 'swiggy') {
                swiggyResults.classList.remove('hidden');
                swiggyBtn.className = swiggyBtn.className.replace('btn-secondary', 'btn-primary') + ' active';
            } else {
                zomatoResults.classList.remove('hidden');
                zomatoBtn.className = zomatoBtn.className.replace('btn-secondary', 'btn-primary') + ' active';
            }
        }

        function findCommonRestaurants(swiggyItems, zomatoItems) {
            const commonPairs = [];
            
            // Improved name normalization
            const normalizeName = (name) => {
                if (!name) return '';
                return name.toLowerCase()
                    .replace(/[^a-z0-9 ]/g, '') // Remove special chars
                    .replace(/\b(the|a|an|and|by|restaurant|cafe|hotel|bakery|pizza)\b/g, '') // Remove common words
                    .replace(/\s+/g, ' ') // Collapse multiple spaces
                    .trim();
            };
            
            // Create a map of normalized names to items
            const swiggyMap = new Map();
            swiggyItems.forEach(item => {
                const normalized = normalizeName(item.Restaurant);
                if (normalized) {
                    swiggyMap.set(normalized, item);
                }
            });
            
            // Try to find matches in Zomato results
            zomatoItems.forEach(zomatoItem => {
                const normalized = normalizeName(zomatoItem.Name);
                if (!normalized) return;
                
                // Check for exact match first
                if (swiggyMap.has(normalized)) {
                    commonPairs.push({
                        swiggy: swiggyMap.get(normalized),
                        zomato: zomatoItem
                    });
                    swiggyMap.delete(normalized); // Prevent duplicate matches
                    return;
                }
                
                // Check for partial matches if no exact match
                for (const [swiggyNormalized, swiggyItem] of swiggyMap) {
                    if (calculateSimilarity(swiggyNormalized, normalized) > 0.7) {
                        commonPairs.push({
                            swiggy: swiggyItem,
                            zomato: zomatoItem
                        });
                        swiggyMap.delete(swiggyNormalized);
                        break;
                    }
                }
            });
            
            return commonPairs;
        }

        // Calculate similarity between two strings (0-1) using Levenshtein distance
        function calculateSimilarity(str1, str2) {
            if (!str1 || !str2) return 0;
            
            // Convert to arrays of words
            const words1 = str1.split(' ');
            const words2 = str2.split(' ');
            
            // Count matching words
            const intersection = words1.filter(word => words2.includes(word));
            const union = [...new Set([...words1, ...words2])];
            
            // If at least one word matches, consider it
            if (intersection.length > 0) {
                return intersection.length / union.length;
            }
            
            // Fallback to character-based similarity
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            const longerLength = longer.length;
            
            if (longerLength === 0) return 1.0;
            
            return (longerLength - levenshteinDistance(longer, shorter)) / parseFloat(longerLength);
        }
        
        // Levenshtein distance implementation
        function levenshteinDistance(s, t) {
            if (s === t) return 0;
            if (s.length === 0) return t.length;
            if (t.length === 0) return s.length;
            
            const v0 = Array(t.length + 1).fill(0);
            const v1 = Array(t.length + 1).fill(0);
            
            for (let i = 0; i < v0.length; i++) {
                v0[i] = i;
            }
            
            for (let i = 0; i < s.length; i++) {
                v1[0] = i + 1;
                
                for (let j = 0; j < t.length; j++) {
                    const cost = s[i] === t[j] ? 0 : 1;
                    v1[j + 1] = Math.min(v1[j] + 1, v0[j + 1] + 1, v0[j] + cost);
                }
                
                for (let j = 0; j < v0.length; j++) {
                    v0[j] = v1[j];
                }
            }
            
            return v1[t.length];
        }

        function createSwiggyCard(item) {
            const card = document.createElement('div');
            card.className = 'card rounded-2xl overflow-hidden';
            
            let imageHtml = '';
            if (item['Image URL'] && item['Image URL'] !== "N/A") {
                imageHtml = `
                    <div class="relative overflow-hidden bg-gradient-to-br from-gray-600 to-gray-700" style="height: 200px;">
                        <img src="${item['Image URL']}" alt="${item.Dish || 'Food item'}" 
                             class="food-image w-full h-full transition-transform duration-300 hover:scale-105"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="hidden w-full h-full items-center justify-center text-gray-400">
                            <i class="fas fa-image text-4xl"></i>
                        </div>
                    </div>
                `;
            } else {
                imageHtml = `
                    <div class="bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center text-gray-400" style="height: 200px;">
                        <i class="fas fa-utensils text-4xl"></i>
                    </div>
                `;
            }
            
            const description = item.Description || 'Delicious food item from this restaurant';
            const priceHtml = item['Discounted Price'] !== item['Original Price'] ? 
                `<span class="text-gray-400 line-through text-sm mr-2">‚Çπ${item['Original Price']}</span>
                 <span class="text-green-400 font-bold text-lg">‚Çπ${item['Discounted Price']}</span>` :
                `<span class="text-white font-bold text-lg">‚Çπ${item['Original Price']}</span>`;
            
            const swiggyUrl = item['Restaurant URL'] || `https://www.swiggy.com/restaurants/${encodeURIComponent(item.Restaurant)}`;
            
            card.innerHTML = `
                ${imageHtml}
                <div class="p-6">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold text-white truncate mr-2">${item.Restaurant}</h3>
                        <div class="flex items-center bg-blue-600 text-white text-sm font-medium px-3 py-1 rounded-full">
                            <i class="fas fa-star mr-1"></i> ${item.Rating}
                        </div>
                    </div>
                    
                    <div class="flex items-center text-gray-400 mb-3">
                        <i class="fas fa-clock mr-2"></i>
                        <span class="text-sm">${item['Delivery Time']}</span>
                    </div>
                    
                    <p class="text-gray-300 text-sm mb-4 line-clamp-2">${description}</p>
                    
                    <div class="flex justify-between items-center">
                        <div>${priceHtml}</div>
                        <a href="${swiggyUrl}" target="_blank" 
                           class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-external-link-alt mr-1"></i> Order
                        </a>
                    </div>
                </div>
            `;
            
            return card;
        }

        function createZomatoCard(item) {
            const card = document.createElement('div');
            card.className = 'card rounded-2xl overflow-hidden';
            
            let imageHtml = '';
            if (item['Image URL'] && item['Image URL'] !== "N/A") {
                imageHtml = `
                    <div class="relative overflow-hidden bg-gradient-to-br from-gray-600 to-gray-700" style="height: 200px;">
                        <img src="${item['Image URL']}" alt="${item.Name}" 
                             class="food-image w-full h-full transition-transform duration-300 hover:scale-105"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="hidden w-full h-full items-center justify-center text-gray-400">
                            <i class="fas fa-image text-4xl"></i>
                        </div>
                    </div>
                `;
            } else {
                imageHtml = `
                    <div class="bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center text-gray-400" style="height: 200px;">
                        <i class="fas fa-utensils text-4xl"></i>
                    </div>
                `;
            }
            
            const cuisine = item.Cuisine ? item.Cuisine.split(', ').slice(0, 3).join(', ') : 'Various cuisines';
            const offerHtml = item.Offer && item.Offer !== "No offer" ? 
                `<div class="bg-green-600 text-white text-xs font-medium px-2 py-1 rounded-full">${item.Offer}</div>` : '';
            
            const zomatoUrl = item['Restaurant URL'] || `https://www.zomato.com/${encodeURIComponent(item.Name)}`;
            
            card.innerHTML = `
                ${imageHtml}
                <div class="p-6">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold text-white truncate mr-2">${item.Name}</h3>
                        <div class="flex items-center bg-green-600 text-white text-sm font-medium px-3 py-1 rounded-full">
                            <i class="fas fa-star mr-1"></i> ${item.Rating}
                        </div>
                    </div>
                    
                    <div class="flex items-center text-gray-400 mb-2">
                        <i class="fas fa-utensils mr-2"></i>
                        <span class="text-sm truncate">${cuisine}</span>
                    </div>
                    
                    <div class="flex items-center text-gray-400 mb-4">
                        <i class="fas fa-clock mr-2"></i>
                        <span class="text-sm">${item['Delivery Time']}</span>
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-white font-bold text-lg">${item.Price}</div>
                        ${offerHtml}
                    </div>
                    
                    <div class="flex justify-end">
                        <a href="${zomatoUrl}" target="_blank" 
                           class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-external-link-alt mr-1"></i> Order
                        </a>
                    </div>
                </div>
            `;
            
            return card;
        }

        function createCommonCard(swiggyItem, zomatoItem) {
            const card = document.createElement('div');
            card.className = 'card rounded-2xl overflow-hidden';
            
            // Use Swiggy image if available, otherwise Zomato image
            let imageUrl = swiggyItem['Image URL'] && swiggyItem['Image URL'] !== "N/A" ? 
                swiggyItem['Image URL'] : 
                (zomatoItem['Image URL'] && zomatoItem['Image URL'] !== "N/A" ? zomatoItem['Image URL'] : null);
            
            let imageHtml = '';
            if (imageUrl) {
                imageHtml = `
                    <div class="relative overflow-hidden bg-gradient-to-br from-gray-600 to-gray-700" style="height: 240px;">
                        <img src="${imageUrl}" alt="${swiggyItem.Restaurant || zomatoItem.Name}" 
                             class="food-image w-full h-full transition-transform duration-300 hover:scale-105"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="hidden w-full h-full items-center justify-center text-gray-400">
                            <i class="fas fa-image text-4xl"></i>
                        </div>
                    </div>
                `;
            } else {
                imageHtml = `
                    <div class="bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center text-gray-400" style="height: 240px;">
                        <i class="fas fa-utensils text-5xl"></i>
                    </div>
                `;
            }
            
            // Extract prices for comparison
            const swiggyPrice = parseFloat(swiggyItem['Discounted Price'] || swiggyItem['Original Price'] || '0');
            const zomatoPriceStr = zomatoItem.Price?.match(/\d+/)?.[0] || '0';
            const zomatoPrice = parseFloat(zomatoPriceStr);
            
            // Calculate price difference
            let priceDifference = 0;
            let cheaperOn = 'Same';
            let winnerColor = 'text-gray-400';
            
            if (swiggyPrice && zomatoPrice) {
                if (swiggyPrice < zomatoPrice) {
                    cheaperOn = 'Swiggy';
                    priceDifference = ((zomatoPrice - swiggyPrice) / zomatoPrice) * 100;
                    winnerColor = 'text-blue-400';
                } else if (swiggyPrice > zomatoPrice) {
                    cheaperOn = 'Zomato';
                    priceDifference = ((swiggyPrice - zomatoPrice) / swiggyPrice) * 100;
                    winnerColor = 'text-green-400';
                }
            }
            
            const swiggyUrl = swiggyItem['Restaurant URL'] || `https://www.swiggy.com/restaurants/${encodeURIComponent(swiggyItem.Restaurant)}`;
            const zomatoUrl = zomatoItem['Restaurant URL'] || `https://www.zomato.com/${encodeURIComponent(zomatoItem.Name)}`;
            
            card.innerHTML = `
                ${imageHtml}
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-white">${swiggyItem.Restaurant || zomatoItem.Name}</h3>
                        <div class="flex space-x-2">
                            <div class="flex items-center bg-blue-600 text-white text-sm font-medium px-3 py-1 rounded-full">
                                <i class="fas fa-motorcycle mr-1"></i> ${swiggyItem.Rating || 'N/A'}
                            </div>
                            <div class="flex items-center bg-green-600 text-white text-sm font-medium px-3 py-1 rounded-full">
                                <i class="fas fa-utensils mr-1"></i> ${zomatoItem.Rating || 'N/A'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-950 bg-opacity-50 border border-blue-800 p-4 rounded-xl">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-motorcycle text-blue-400 mr-2"></i>
                                <h4 class="font-semibold text-blue-400">Swiggy</h4>
                            </div>
                            <p class="text-gray-300 text-sm mb-2">${swiggyItem['Delivery Time'] || 'N/A'}</p>
                            <p class="text-white font-bold text-lg">‚Çπ${swiggyPrice.toFixed(0)}</p>
                        </div>
                        <div class="bg-green-950 bg-opacity-50 border border-green-800 p-4 rounded-xl">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-utensils text-green-400 mr-2"></i>
                                <h4 class="font-semibold text-green-400">Zomato</h4>
                            </div>
                            <p class="text-gray-300 text-sm mb-2">${zomatoItem['Delivery Time'] || 'N/A'}</p>
                            <p class="text-white font-bold text-lg">‚Çπ${zomatoPrice.toFixed(0)}</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 bg-opacity-50 border border-gray-700 p-4 rounded-xl mb-6">
                        <h4 class="font-semibold text-gray-300 mb-3 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>Price Comparison
                        </h4>
                        
                        <div class="price-comparison-bar mb-3"></div>
                        
                        <div class="text-center">
                            ${cheaperOn !== 'Same' ? `
                                <div class="font-semibold ${winnerColor} text-lg">
                                    <i class="fas fa-trophy mr-2"></i>
                                    ${cheaperOn} is ${priceDifference.toFixed(0)}% cheaper
                                </div>
                            ` : `
                                <div class="font-semibold text-gray-400">
                                    <i class="fas fa-equals mr-2"></i>
                                    Prices are equal
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <a href="${swiggyUrl}" target="_blank" 
                           class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-xl text-center font-medium transition-colors">
                            <i class="fas fa-motorcycle mr-2"></i>Swiggy
                        </a>
                        <a href="${zomatoUrl}" target="_blank" 
                           class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-xl text-center font-medium transition-colors">
                            <i class="fas fa-utensils mr-2"></i>Zomato
                        </a>
                    </div>
                </div>
            `;
            
            return card;
        }
    </script>
</body>
</html>